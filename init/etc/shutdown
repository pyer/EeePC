#!/bin/sh
export PATH=/sbin:/bin

echo "Waiting for services to stop"
for service in /etc/svdir/enabled/*
do
  echo -n "d" >$service/control
done

WAIT=0
while [ $WAIT -eq 0 ]
do
  WAIT=1
  for service in /etc/svdir/enabled/*
  do
    echo -n "."
    if [ "$(cat $service/status)" != "down" ]
    then
      WAIT=0
    fi
  done
done
echo ""

echo "Shutdown in progress ..."
# Stop all with killer scripts
for script in /etc/shutdown.d/K*
do
  "$script"
done
